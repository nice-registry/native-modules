{"name":"iobroker.modbus","version":"0.5.3","description":"Connect devices oder Modbus protocol to ioBroker","homepage":"https://github.com/ioBroker/ioBroker.modbus","license":"MIT","keywords":["ioBroker","modbus","Smart Home","home automation"],"repository":"https://github.com/ioBroker/ioBroker.modbus","optionalDependencies":{"serialport":"^4.0.7"},"dependencies":{"jsmodbus":"1.2.4","stampit":"^2.1.2","put":"0.0.6","crc":"3.4.0","stampit-state-machine":"^0.2.1","stampit-event-bus":"^0.1.1","stampit-log":"^0.3.0","serialport":"^4.0.7"},"devDependencies":{"grunt":"^0.4.5","grunt-replace":"^0.9.3","grunt-contrib-jshint":"^0.11.2","grunt-jscs":"^2.0.0","grunt-http":"^1.6.0","mocha":"^2.3.4","chai":"^3.4.1","nan":"2.4.0"},"main":"main.js","scripts":{"test":"node node_modules/mocha/bin/mocha test/testAdapter.js"},"gitHead":"4c5a368a1c2e04f5be1c24b14da6255a2b1801ec","versions":[{"number":"0.2.2","date":"2015-10-14T20:14:18.945Z"},{"number":"0.2.3","date":"2015-10-15T19:27:12.108Z"},{"number":"0.2.5","date":"2015-10-20T19:52:40.891Z"},{"number":"0.2.6","date":"2015-10-22T21:54:04.015Z"},{"number":"0.3.0","date":"2015-10-24T22:21:30.315Z"},{"number":"0.3.1","date":"2015-10-26T22:46:36.048Z"},{"number":"0.3.2","date":"2015-10-27T05:47:16.437Z"},{"number":"0.3.3","date":"2015-10-27T19:54:52.331Z"},{"number":"0.3.5","date":"2015-10-31T17:10:32.494Z"},{"number":"0.3.6","date":"2015-11-01T17:32:00.466Z"},{"number":"0.3.7","date":"2015-11-02T20:35:01.411Z"},{"number":"0.3.8","date":"2015-11-09T19:58:20.680Z"},{"number":"0.3.9","date":"2015-11-09T20:12:42.559Z"},{"number":"0.3.10","date":"2016-02-01T19:28:52.010Z"},{"number":"0.3.11","date":"2016-08-18T18:49:45.768Z"},{"number":"0.4.5","date":"2016-11-04T17:58:02.122Z"},{"number":"0.4.6","date":"2016-11-08T19:20:12.778Z"},{"number":"0.4.7","date":"2016-11-27T18:28:55.630Z"},{"number":"0.5.0","date":"2017-02-22T07:21:02.367Z"},{"number":"0.5.1","date":"2017-03-11T23:50:19.839Z"},{"number":"0.5.2","date":"2017-03-15T21:39:10.507Z"},{"number":"0.5.3","date":"2017-05-24T21:03:59.225Z"}],"readme":"![Logo](admin/modbus.png)\r\n## iobroker.modbus\r\n=====================\r\n[![NPM version](http://img.shields.io/npm/v/iobroker.modbus.svg)](https://www.npmjs.com/package/iobroker.modbus)\r\n[![Downloads](https://img.shields.io/npm/dm/iobroker.modbus.svg)](https://www.npmjs.com/package/iobroker.modbus)\r\n\r\n[![NPM](https://nodei.co/npm/iobroker.modbus.png?downloads=true)](https://nodei.co/npm/iobroker.modbus/)\r\n\r\nImplementation of ModBus Slave and Master for ioBroker. Following types are supported:\r\n- Modbus RTU over serial (slave)\r\n- Modbus RTU over TCP (slave)\r\n- Modbus TCP (slave, master)\r\n\r\n### Settings\r\n#### Partner IP Address\r\nIP address of modbus partner.\r\n\r\n#### Port\r\nTCP Port of modbus partner if configured as master (client) or own port if configured as slave(server).\r\n\r\n#### Device ID\r\nModbus Device ID. Important if TCP/Modbus bridge is used.\r\n\r\n#### Type\r\nSlave(Server) or Master(Client).\r\n\r\n#### Use aliases as address\r\nNormally all registers can have address from 0 to 65535. By using of aliases you can define virtual address fields for every type of registers. Normally:\r\n- discrete inputs are from 10001 to 20000\r\n- coils are from 1 to 1000\r\n- input registers are from 30001 to 40000\r\n- holding registers are from 40001 to 60000\r\n\r\nEvery alias will be mapped internally to address, e.g. 30011 will be mapped to input register 10. and so on.\r\n\r\n#### Round Real to\r\nHow many digits after comma for float and doubles.\r\n\r\n#### Poll delay\r\nCyclic poll interval (Only relevant for master)\r\n\r\n#### Reconnect time\r\nReconnection interval (Only relevant for master)\r\n\r\n#### Pulse time\r\nif pulse used for coils, this define the interval how long is pulse.\r\n\r\n#### Max read request length\r\nMaximal length of command READ_MULTIPLE_REGISTERS as number of registers to read.\r\n\r\nSome systems require first \"write request\" to deliver the data on \"read request\".\r\nYou can force this mode by setting of the \"Max read request length\" to 1.\r\n\r\n**Notice:**\r\nSome USB Modbus solutions (e.g. based on socat) can have trouble to work with serialport npm module.\r\n\r\nThere is a software [**Modbus RTU <-> Modbus RTU over TCP**](http://mbus.sourceforge.net/index.html) gateway to enable using of serial RTU over TCP protocol.\r\n\r\nBoth solutions **RTU over TCP** and **TCP** works well.\r\n\r\n## Data types\r\n\r\n- uint16be - Unsigned 16 bit (Big Endian): AABB => AABB\r\n- uint16le - Unsigned 16 bit (Little Endian): AABB => BBAA\r\n- int16be  - Signed 16 bit (Big Endian): AABB => AABB\r\n- int16le  - Signed 16 bit (Little Endian): AABB => BBAA\r\n- uint32be - Unsigned 32 bit (Big Endian): AABBCCDD => AABBCCDD\r\n- uint32le - Unsigned 32 bit (Little Endian): AABBCCDD => DDCCBBAA\r\n- uint32sw - Unsigned 32 bit (Big Endian Word Swap): AABBCCDD => CCDDAABB\r\n- uint32sb - Unsigned 32 bit (Big Endian Byte Swap): AABBCCDD => DDCCBBAA\r\n- int32be  - Signed 32 bit (Big Endian): AABBCCDD => AABBCCDD\r\n- int32le  - Signed 32 bit (Little Endian): ABBCCDD => DDCCBBAA\r\n- int32sw  - Signed 32 bit (Big Endian Word Swap): AABBCCDD => CCDDAABB\r\n- int32sb  - Signed 32 bit (Big Endian Byte Swap): AABBCCDD => DDCCBBAA\r\n- uint64be - Unsigned 64 bit (Big Endian): AABBCCDDEEFFGGHH => AABBCCDDEEFFGGHH\r\n- uint64le - Unsigned 64 bit (Little Endian): AABBCCDDEEFFGGHH => HHGGFFEEDDCCBBAA\r\n- uint8be  - Unsigned 8 bit (Big Endian): AA => AA\r\n- uint8le  - Unsigned 8 bit (Little Endian): AA => AA\r\n- int8be   - Signed 8 bit (Big Endian): AA => AA\r\n- int8le   - Signed 8 bit (Little Endian): AA => AA\r\n- floatbe  - Float (Big Endian): AABBCCDD => AABBCCDD\r\n- floatle  - Float (Little Endian): AABBCCDD => DDCCBBAA\r\n- floatsw  - Float (Big Endian Word Swap): AABBCCDD => CCDDAABB\r\n- floatsb  - Float (Big Endian Byte Swap): AABBCCDD => DDCCBBAA\r\n- doublebe - Double (Big Endian): AABBCCDDEEFFGGHH => AABBCCDDEEFFGGHH\r\n- doublele - Double (Little Endian): AABBCCDDEEFFGGHH => HHGGFFEEDDCCBBAA\r\n- string   - String (Zero-end): ABCDEF\\0 => ABCDEF\\0\r\n\r\nFollowing description was copied from [here](http://www.chipkin.com/how-real-floating-point-and-32-bit-data-is-encoded-in-modbus-rtu-messages/)\r\n\r\nThe point-to-point Modbus protocol is a popular choice for RTU communications if for no other reason that it’s basic convenience. The protocol itself controls the interactions of each device on a Modbus network, how device establishes a known address, how each device recognizes its messages and how basic information is extracted from the data. In essence, the protocol is the foundation of the entire Modbus network.\r\n\r\nSuch convenience does not come without some complications however, and Modbus RTU Message protocol is no exception. The protocol itself was designed based on devices with a 16-bit register length. Consequently, special considerations were required when implementing 32-bit data elements. This implementation settled on using two consecutive 16-bit registers to represent 32 bits of data or essentially 4 bytes of data. It is within these 4 bytes of data that single-precision floating point data can be encoded into a Modbus RTU message.\r\n\r\n### The Importance of Byte Order\r\n\r\nModbus itself does not define a floating point data type but it is widely accepted that it implements 32-bit floating point data using the IEEE-754 standard. However, the IEEE standard has no clear cut definition of byte order of the data payload. Therefore the most important consideration when dealing with 32-bit data is that data is addressed in the proper order.\r\n\r\nFor example, the number 123/456.00 as defined in the IEEE 754 standard for single-precision 32-bit floating point numbers appears as follows:\r\n\r\n![Image1](img/img1.png)\r\n\r\nThe affects of various byte orderings are significant. For example, ordering the 4 bytes of data that represent 123456.00 in a “B A D C” sequence in known as a “byte swap”. When interpreted as an IEEE 744 floating point data type, the result is quite different:\r\n\r\n![Image2](img/img2.png)\r\n\r\nOrdering the same bytes in a “C D A B” sequence is known as a “word swap”. Again, the results differ drastically from the original value of 123456.00:\r\n\r\n![Image3](img/img3.png)\r\n\r\nFurthermore, both a “byte swap” and a “word swap” would essentially reverse the sequence of the bytes altogether to produce yet another result:\r\n\r\n![Image4](img/img4.png)\r\n\r\nClearly, when using network protocols such as Modbus, strict attention must be paid to how bytes of memory are ordered when they are transmitted, also known as the ‘byte order’.\r\n\r\n### Determining Byte Order\r\n\r\nThe Modbus protocol itself is declared as a ‘big-Endian’ protocol, as per the Modbus Application Protocol Specification, V1.1.b:\r\n\r\n```Modbus uses a “big-Endian” representation for addresses and data items. This means that when a numerical quantity larger than a single byte is transmitted, the most significant byte is sent first.```\r\n\r\nBig-Endian is the most commonly used format for network protocols – so common, in fact, that it is also referred to as ‘network order’.\r\n\r\nGiven that the Modbus RTU message protocol is big-Endian, in order to successfully exchange a 32-bit datatype via a Modbus RTU message, the endianness of both the master and the slave must considered. Many RTU master and slave devices allow specific selection of byte order particularly in the case of software-simulated units. One must merely insure that both all units are set to the same byte order.\r\n\r\nAs a rule of thumb, the family of a device’s microprocessor determines its endianness. Typically, the big-Endian style (the high-order byte is stored first, followed by the low-order byte) is generally found in CPUs designed with a Motorola processor. The little-Endian style (the low-order byte is stored first, followed by the high-order byte) is generally found in CPUs using the Intel architecture. It is a matter of personal perspective as to which style is considered ‘backwards’.\r\n\r\nIf, however, byte order and endianness is not a configurable option, you will have to determine the how to interpret the byte. This can be done requesting a known floating-point value from the slave. If an impossible value is returned, i.e. a number with a double-digit exponent or such, the byte ordering will most likely need modification.\r\n\r\n### Practical Help\r\n\r\nThe FieldServer Modbus RTU drivers offer several function moves that handle 32-bit integers and 32-bit float values. More importantly, these function moves consider all different forms of byte sequencing. The following table shows the FieldServer function moves that copy two adjacent 16-bit registers to a 32-bit integer value.\r\n\r\n| Function Keyword  | Swap Mode          | Source Bytes    | Target Bytes |\r\n|-------------------|--------------------|-----------------|--------------|\r\n| 2.i16-1.i32       | N/A                | [ a b ] [ c d ] | [ a b c d ]  |\r\n| 2.i16-1.i32-s     | byte and word swap | [ a b ] [ c d ] | [ d c b a ]  |\r\n| 2.i16-1.i32-sb    | byte swap          | [ a b ] [ c d ] | [ b a d c ]  |\r\n| 2.i16-1.i32-sw    | word swap          | [ a b ] [ c d ] | [ c d a b ]  |\r\n\r\nThe following table shows the FieldServer function moves that copy two adjacent 16-bit registers to a 32-bit floating point value:\r\n\r\n| Function Keyword  | Swap Mode          | Source Bytes    | Target Bytes |\r\n|-------------------|--------------------|-----------------|--------------|\r\n| 2.i16-1.ifloat    | N/A                | [ a b ] [ c d ] | [ a b c d ]  |\r\n| 2.i16-1.ifloat-s  | byte and word swap | [ a b ] [ c d ] | [ d c b a ]  |\r\n| 2.i16-1.ifloat-sb | byte swap          | [ a b ] [ c d ] | [ b a d c ]  |\r\n| 2.i16-1.ifloat-sw | word swap          | [ a b ] [ c d ] | [ c d a b ]  |\r\n\r\nThe following table shows the FieldServer function moves that copy a single 32-bit floating point value to two adjacent 16-bit registers:\r\n\r\n| Function Keyword | Swap Mode         | Source Bytes    | Target Bytes   |\r\n|------------------|-------------------|-----------------|----------------|\r\n| 1.float-2.i16    |N/A                | [ a b ] [ c d ] | [ a b ][ c d ] |\r\n| 1.float-2.i16-s  |byte and word swap | [ a b ] [ c d ] | [ d c ][ b a ] |\r\n| 1.float-2.i16-sb |byte swap          | [ a b ] [ c d ] | [ b a ][ d c ] |\r\n| 1.float-2.i16-sw |word swap          | [ a b ] [ c d ] | [ c d ][ a b ] |\r\n\r\nGiven the various FieldServer function moves, the correct handling of 32-bit data is dependent on choosing the proper one. Observe the following behavior of these FieldServer function moves on the known single-precision decimal float value of 123456.00:\r\n\r\n|16-bit Values\t| Function Move\t    | Result\t| Function Move\t    | Result        |\r\n|---------------|-------------------|-----------|-------------------|---------------|\r\n|0x2000 0x47F1\t| 2.i16-1.float\t    | 123456.00\t| 1.float-2.i16\t    | 0x2000 0x47F1 |\r\n|0xF147 0x0020\t| 2.i16-1.float-s\t| 123456.00\t| 1.float-2.i16-s\t| 0xF147 0X0020 |\r\n|0x0020 0xF147\t| 2.i16-1.float-sb\t| 123456.00\t| 1.float-2.i16-sb\t| 0x0020 0xF147 |\r\n|0x47F1 0x2000\t| 2.i16-1.float-sw\t| 123456.00\t| 1.float-2.i16-sw\t| 0x47F1 0x2000 |\r\n\r\nNotice that different byte and word orderings require the use of the appropriate FieldServer function move. Once the proper function move is selected, the data can be converted in both directions.\r\n\r\nOf the many hex-to-floating point converters and calculators that are available in the Internet, very few actually allow manipulation of the byte and word orders. One such utility is located at www.61131.com/download.htm where both Linux and Windows versions of the utilities can be downloaded. Once installed, the utility is run as an executable with a single dialog interface. The utility presents the decimal float value of 123456.00 as follows:\r\n\r\n![Image5](img/img5.png)\r\n\r\nOne can then swap bytes and/or words to analyze what potential endianness issues may exist between Modbus RTU master and slave devices.\r\n\r\n## Changelog\r\n# 0.5.0 (2017-02-11)\r\n* (bluefox) Create all states each after other\r\n\r\n# 0.4.10 (2017-02-10)\r\n* (Apollon77) Do not recreate all datapoints on start of adapter\r\n* (ykuendig) Multiple optimization and wording fixes\r\n\r\n# 0.4.9 (2016-12-20)\r\n* (bluefox) fix serial RTU\r\n\r\n# 0.4.8 (2016-12-15)\r\n* (Apollon77) update serialport library for node 6.x compatibility\r\n\r\n# 0.4.7 (2016-11-27)\r\n* (bluefox) Use old version of jsmodbus\r\n\r\n# 0.4.6 (2016-11-08)\r\n* (bluefox) backward compatibility with 0.3.x\r\n\r\n# 0.4.5 (2016-10-25)\r\n* (bluefox) better buffer handling on tcp and serial\r\n\r\n# 0.4.4 (2016-10-21)\r\n* (bluefox) Fix write of holding registers\r\n\r\n# 0.4.1 (2016-10-19)\r\n* (bluefox) Support of ModBus RTU over serial and over TCP (only slave)\r\n\r\n# 0.3.11 (2016-08-18)\r\n* (Apollon77) Fix wrong byte count in loop\r\n\r\n# 0.3.10 (2016-02-01)\r\n* (bluefox) fix lost of history settings.\r\n\r\n# 0.3.9 (2015-11-09)\r\n* (bluefox) Use always write_multiple_registers by write of holding registers.\r\n\r\n# 0.3.7 (2015-11-02)\r\n* (bluefox) add special read/write mode if \"Max read request length\" is 1.\r\n\r\n# 0.3.6 (2015-11-01)\r\n* (bluefox) add cyclic write for holding registers (fix)\r\n\r\n# 0.3.5 (2015-10-31)\r\n* (bluefox) add cyclic write for holding registers\r\n\r\n# 0.3.4 (2015-10-28)\r\n* (bluefox) add doubles and fix uint64\r\n\r\n# 0.3.3 (2015-10-27)\r\n* (bluefox) fix holding registers\r\n\r\n# 0.3.2 (2015-10-27)\r\n* (bluefox) fix import from text file\r\n\r\n# 0.3.1 (2015-10-26)\r\n* (bluefox) fix error with length of read block (master)\r\n* (bluefox) support of read blocks and maximal length of read request (master)\r\n* (bluefox) can define fields by import\r\n\r\n# 0.3.0 (2015-10-24)\r\n* (bluefox) add round settings\r\n* (bluefox) add deviceID\r\n* (bluefox) slave supports floats, integers and strings\r\n\r\n# 0.2.6 (2015-10-22)\r\n* (bluefox) add different types for inputRegisters and for holding registers ONLY FOR MASTER\r\n\r\n# 0.2.5 (2015-10-20)\r\n* (bluefox) fix names of objects if aliases used\r\n\r\n# 0.2.4 (2015-10-19)\r\n* (bluefox) fix error add new values\r\n\r\n# 0.2.3 (2015-10-15)\r\n* (bluefox) fix error with master\r\n\r\n# 0.2.2 (2015-10-14)\r\n* (bluefox) implement slave\r\n* (bluefox) change addressing model\r\n\r\n# 0.0.1\r\n* (bluefox) initial commit\r\n","created":"2015-10-14T20:14:18.945Z","modified":"2017-05-24T21:03:59.225Z","lastPublisher":{"name":"bluefox","email":"dogafox@gmail.com"},"owners":[{"name":"bluefox","email":"dogafox@gmail.com"}],"other":{"_attachments":{},"_from":".","_id":"iobroker.modbus","_nodeVersion":"6.9.4","_npmOperationalInternal":{"host":"s3://npm-registry-packages","tmp":"tmp/iobroker.modbus-0.5.3.tgz_1495659837892_0.8888187850825489"},"_npmUser":{"name":"bluefox","email":"dogafox@gmail.com"},"_npmVersion":"3.10.10","_rev":"8-249b65ddda8e6bb8c1dd2c13d0aa17a5","_shasum":"6e00d28e40e9f45643c8706eb83a128239ce88f7","author":{"name":"bluefox","email":"dogafox@gmail.com"},"bugs":{"url":"https://github.com/ioBroker/ioBroker.modbus/issues"},"contributors":[{"name":"bluefox","email":"dogafox@gmail.com"}],"directories":{},"dist-tags":{"latest":"0.5.3"},"dist":{"shasum":"6e00d28e40e9f45643c8706eb83a128239ce88f7","tarball":"https://registry.npmjs.org/iobroker.modbus/-/iobroker.modbus-0.5.3.tgz"},"maintainers":[{"name":"bluefox","email":"dogafox@gmail.com"}],"readmeFilename":"README.md","time":{"modified":"2017-05-24T21:03:59.225Z","created":"2015-10-14T20:14:18.945Z","0.2.2":"2015-10-14T20:14:18.945Z","0.2.3":"2015-10-15T19:27:12.108Z","0.2.5":"2015-10-20T19:52:40.891Z","0.2.6":"2015-10-22T21:54:04.015Z","0.3.0":"2015-10-24T22:21:30.315Z","0.3.1":"2015-10-26T22:46:36.048Z","0.3.2":"2015-10-27T05:47:16.437Z","0.3.3":"2015-10-27T19:54:52.331Z","0.3.5":"2015-10-31T17:10:32.494Z","0.3.6":"2015-11-01T17:32:00.466Z","0.3.7":"2015-11-02T20:35:01.411Z","0.3.8":"2015-11-09T19:58:20.680Z","0.3.9":"2015-11-09T20:12:42.559Z","0.3.10":"2016-02-01T19:28:52.010Z","0.3.11":"2016-08-18T18:49:45.768Z","0.4.5":"2016-11-04T17:58:02.122Z","0.4.6":"2016-11-08T19:20:12.778Z","0.4.7":"2016-11-27T18:28:55.630Z","0.5.0":"2017-02-22T07:21:02.367Z","0.5.1":"2017-03-11T23:50:19.839Z","0.5.2":"2017-03-15T21:39:10.507Z","0.5.3":"2017-05-24T21:03:59.225Z"}}}