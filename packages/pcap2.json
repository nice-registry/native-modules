{"name":"pcap2","version":"3.0.4","description":"raw packet capture, decoding, and analysis","license":"MIT","main":"./index","repository":"https://github.com/andygreenegrass/node-pcap","engines":{"node":">=4.2.1"},"dependencies":{"nan":"^2.0.9","socketwatcher":"^0.3.0"},"devDependencies":{"grunt":"^0.4.5","grunt-cli":"^0.1.13","grunt-contrib-jshint":"^0.11.0","grunt-coveralls":"^1.0.0","grunt-mocha-istanbul":"^2.3.1","grunt-mocha-test":"^0.12.7","istanbul":"^0.3.5","mocha":"^2.1.0","mocha-sinon":"^1.1.4","should":"^5.0.0","sinon":"^1.14.1"},"scripts":{"test":"grunt","install":"node-gyp rebuild"},"gypfile":true,"gitHead":"4d8d15d3ab18c34f3401066a0ecfc9625849b35a","homepage":"https://github.com/andygreenegrass/node-pcap#readme","versions":[{"number":"2.0.0","date":"2015-12-03T20:03:27.992Z"},{"number":"2.0.1","date":"2015-12-04T16:51:16.033Z"},{"number":"3.0.0","date":"2015-12-05T05:20:47.503Z"},{"number":"3.0.1","date":"2015-12-07T19:30:18.453Z"},{"number":"3.0.2","date":"2015-12-07T19:32:14.484Z"},{"number":"3.0.3","date":"2015-12-07T20:00:55.702Z"},{"number":"3.0.4","date":"2015-12-08T18:26:25.209Z"}],"readme":"node-pcap\n=========\n\n[![npm version badge](https://img.shields.io/npm/v/pcap2.svg)](https://www.npmjs.org/package/pcap2)\n\nThis is a set of bindings from `libpcap` to node as well as some useful libraries to decode, print, and\nanalyze packets.  `libpcap` is a packet capture library used by programs like `tcpdump` and `wireshark`.\nIt has been tested on OSX and Linux.\n\n`node-pcap` is useful for many things, but it does not yet understand all common protocols.  Common reasons\nto use this package are\n[http_trace](https://github.com/mranney/http_trace), and\n[htracr](https://github.com/mnot/htracr).\n\n## Why capture packets in JavaScript?\n\nThere are already many tools for capturing, decoding, and analyzing packets.  Many of them are thoroughly\ntested and very fast.  Why would anybody want to do such low level things like packet capture and analysis\nin JavaScript?  A few reasons:\n\n* JavaScript makes writing event-based programs very natural.  Each packet that is captured generates an\nevent, and as higher level protocols are decoded, they might generate events as well.  Writing code to handle\nthese events is much easier and more readable with anonymous functions and closures.\n\n* node makes handling binary data in JavaScript fast and efficient with its Buffer class.  Decoding packets involves\na lot of binary slicing and dicing which can be awkward with JavaScript strings.\n\n* Writing servers that capture packets, process them somehow, and then serve the processed data up in some way is\nvery straightforward in node.\n\n* Node has a very good HTTP parser that is used to progressively decode HTTP sessions.\n\n## Installation\n\nYou will need `libpcap` installed.  Most OSX machines seem to have it.  All major Linux distributions have it available\neither by default or with a package like `libpcap-dev`.\n\nThe easiest way to get `node-pcap` and its tools is with `npm`:\n\n```shell\nnpm install pcap2\n```\n\nIf you want to hack on the source code, you can get it from github.  Clone the repo like this:\n\n```shell\ngit clone git://github.com/andygreenegrass/node-pcap.git\n```\n\nTo compile the native code bindings, do this:\n\n```shell\ncd node-pcap\nnode-gyp configure build\n```\n\nAssuming it built without errors, you should be able to run the examples and then write your own packet\ncapture programs.\n\n\n## Usage\n\nThere are several example programs that show how to use `node-pcap`.  These examples are best documentation.\nTry them out and see what they do.\n\nTo use this library in your own program, `index.js` and `pcap_binding.node` must be in `NODE_PATH`.  `npm`\ntakes care of this automatically.\n\n### Starting a capture session\n\nTo start a capture session, create a new `pcap.Session` object with an interface name and desired options:\n\n```javascript\nvar pcap = require('pcap2'),\n    pcapSession = new pcap.Session(interface, options);\n```\n\n`interface` is the name of the interface on which to capture packets.  If passed an empty string, `libpcap`\nwill try to pick a \"default\" interface, which is often just the first one in some list and not what you want.\n\nNote that `node-pcap` always opens the interface in promiscuous mode, which generally requires running as root.\nUnless you are recklessly roaming about as root already, you'll probably want to start your node program like this:\n\n```shell\nsudo node test.js\n```\n\n`pcap.Session` is an `EventEmitter` that emits a `packet` event.  The only argument to the callback will be a\n`Buffer` object with the raw bytes returned by `libpcap`.\n\nListening for packets:\n\n```js\npcapSession.on('packet', function (rawPacket) {\n    // do some stuff with a raw packet\n});\n```\n\nTo convert `rawPacket` into a JavaScript object that is easy to work with, decode it:\n\n```js\nvar packet = pcap.decode.packet(rawPacket);\n```\n\nThe protocol stack is exposed as a nested set of objects.  For example, the TCP destination port is part of TCP\nwhich is encapsulated within IP, which is encapsulated within a link layer.  Access it like this:\n\n    packet.link.ip.tcp.dport\n\nThis structure is easy to explore with `sys.inspect`.\n\n### TCP Analysis\n\nTCP can be analyzed by feeding the packets into a `TCPTracker` and then listening for `session` and `end` events.\n\n```js\nvar pcap = require('pcap2'),\n    tcpTracker = new pcap.TCPTracker(),\n    pcapSession = new pcap.Session('en0', {\n        filter: 'ip proto \\\\tcp'\n    });\n\ntcpTracker.on('session', function (session) {\n  console.log('Start of session between ' + session.src_name + ' and ' + session.dst_name);\n  session.on('end', function (session) {\n      console.log('End of TCP session between ' + session.src_name + ' and ' + session.dst_name);\n  });\n});\n\npcapSession.on('packet', function (rawPacket) {\n    var packet = pcap.decode.packet(rawPacket);\n    tcpTracker.track_packet(packet);\n});\n```\n\nYou must only send IPv4 TCP packets to the TCP tracker.  Explore the `session` object with `sys.inspect` to\nsee the wonderful things it can do for you.  Hopefully the names of the properties are self-explanatory:\n\n## Some Common Problems\n\n### TCP Segmentation Offload - TSO\n\nTSO is a technique that modern operating systems use to offload the burden of IP/TCP header computation to\nthe network hardware.  It also reduces the number of times that data is moved data between the kernel and the\nnetwork hardware.  TSO saves CPU when sending data that is larger than a single IP packet.\n\nThis is amazing and wonderful, but it does make some kinds of packet sniffing more difficult.  In many cases,\nit is important to see the exact packets that are sent, but if the network hardware is sending the packets,\nthese are not available to `libpcap`.  The solution is to disable TSO.\n\nOSX:\n\n```shell\nsudo sysctl -w net.inet.tcp.tso=0\n```\n\nLinux (substitute correct interface name):\n\n```shell\nsudo ethtool -K eth0 tso off\n```\n\nThe symptoms of needing to disable TSO are messages like, \"Received ACK for packet we didn't see get sent\".\n\n### IPv6\n\nSadly, `node-pcap` does not know how to decode IPv6 packets yet.  Often when capturing traffic to `localhost`, IPv6 traffic\nwill arrive surprisingly, even though you were expecting IPv4.  A common case is the hostname `localhost`, which many client programs will\nresolve to the IPv6 address `::1` and then will try `127.0.0.1`.  Until we get IPv6 decode support, a `libpcap` filter can be\nset to only see IPv4 traffic:\n\n```shell\nsudo http_trace lo0 \"ip proto \\tcp\"\n```\n\nThe backslash is important.  The pcap filter language has an ambiguity with the word \"tcp\", so by escaping it,\nyou'll get the correct interpretation for this case.\n\n### Dropped packets\n\nThere are several levels of buffering involved in capturing packets.  Sometimes these buffers fill up, and\nyou'll drop packets.  If this happens, it becomes difficult to reconstruct higher level protocols.  The best\nway to keep the buffers from filling up is to use pcap filters to only consider traffic that you need to decode.\nThe pcap filters are very efficient and run close to the kernel where they can process high packet rates.\n\nIf the pcap filters are set correctly and `libpcap` still drops packets, it is possible to increase `libpcap`'s\nbuffer size.  At the moment, this requires changing `pcap_binding.cc`.  Look for `pcap_set_buffer_size()` and\nset to a larger value.\n\n## LICENSE - \"MIT License\"\n\nCopyright (c) 2010 Matthew Ranney, http://ranney.com/\n\nPermission is hereby granted, free of charge, to any person\nobtaining a copy of this software and associated documentation\nfiles (the \"Software\"), to deal in the Software without\nrestriction, including without limitation the rights to use,\ncopy, modify, merge, publish, distribute, sublicense, and/or sell\ncopies of the Software, and to permit persons to whom the\nSoftware is furnished to do so, subject to the following\nconditions:\n\nThe above copyright notice and this permission notice shall be\nincluded in all copies or substantial portions of the Software.\n\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND,\nEXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES\nOF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND\nNONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT\nHOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY,\nWHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING\nFROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\nOTHER DEALINGS IN THE SOFTWARE.\n","created":"2015-12-03T20:03:27.992Z","modified":"2015-12-08T18:26:25.209Z","lastPublisher":{"name":"andygreenegrass","email":"andygreenegrass@gmail.com"},"owners":[{"name":"andygreenegrass","email":"andygreenegrass@gmail.com"}],"other":{"_attachments":{},"_from":".","_id":"pcap2","_nodeVersion":"4.2.3","_npmUser":{"name":"andygreenegrass","email":"andygreenegrass@gmail.com"},"_npmVersion":"3.5.2","_rev":"1-5617821211dd851f8bf1d6f22b8d836c","_shasum":"d98ddf9e9c81f91aebf75fd44639861ff67ce5b3","author":{"name":"Matt Ranney","email":"mjr@ranney.com"},"bugs":{"url":"https://github.com/andygreenegrass/node-pcap/issues"},"directories":{},"dist-tags":{"latest":"3.0.4"},"dist":{"shasum":"d98ddf9e9c81f91aebf75fd44639861ff67ce5b3","tarball":"http://registry.npmjs.org/pcap2/-/pcap2-3.0.4.tgz"},"maintainers":[{"name":"andygreenegrass","email":"andygreenegrass@gmail.com"}],"readmeFilename":"README.md","time":{"modified":"2015-12-08T18:26:25.209Z","created":"2015-12-03T20:03:27.992Z","2.0.0":"2015-12-03T20:03:27.992Z","2.0.1":"2015-12-04T16:51:16.033Z","3.0.0":"2015-12-05T05:20:47.503Z","3.0.1":"2015-12-07T19:30:18.453Z","3.0.2":"2015-12-07T19:32:14.484Z","3.0.3":"2015-12-07T20:00:55.702Z","3.0.4":"2015-12-08T18:26:25.209Z"}}}