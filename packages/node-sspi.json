{"name":"node-sspi","version":"0.2.1","description":"Windows SSPI server-side authentication for Node","main":"index.js","license":"MIT","scripts":{"install":"node ./build.js"},"dependencies":{"bindings":"^1.1.1","nan":"^2.0.9"},"engines":{"node":">=4.0.0"},"os":["win32"],"repository":"https://github.com/abbr/nodesspi","homepage":"https://github.com/abbr/nodesspi","keywords":["sspi","authentication","ntlm","kerberos"],"gitHead":"1c4fccebd3b8664b10f18163cebb599d58cf62e9","versions":[{"number":"0.0.1","date":"2014-07-07T03:59:26.295Z"},{"number":"0.0.2","date":"2014-07-07T07:14:35.931Z"},{"number":"0.0.3","date":"2014-07-08T02:45:52.534Z"},{"number":"0.0.4","date":"2014-07-08T06:18:19.766Z"},{"number":"0.1.0","date":"2014-07-11T21:07:30.494Z"},{"number":"0.1.1","date":"2014-07-19T00:39:48.273Z"},{"number":"0.1.2","date":"2014-07-19T00:54:33.251Z"},{"number":"0.1.3","date":"2014-07-19T04:58:06.153Z"},{"number":"0.1.4","date":"2014-07-19T05:54:36.914Z"},{"number":"0.1.5","date":"2015-02-26T04:40:04.300Z"},{"number":"0.1.6","date":"2015-03-02T04:53:21.775Z"},{"number":"0.1.7","date":"2015-03-02T04:59:23.921Z"},{"number":"0.1.8","date":"2015-03-08T02:38:45.089Z"},{"number":"0.1.9","date":"2015-09-14T00:00:03.091Z"},{"number":"0.1.10","date":"2015-09-21T01:31:45.455Z"},{"number":"0.1.11","date":"2015-09-26T18:22:28.428Z"},{"number":"0.1.12","date":"2015-11-22T18:41:16.667Z"},{"number":"0.1.13","date":"2016-07-10T00:31:47.816Z"},{"number":"0.1.14","date":"2016-10-29T22:03:43.391Z"},{"number":"0.1.15","date":"2017-06-17T17:42:12.836Z"},{"number":"0.2.0","date":"2017-08-26T04:30:34.216Z"},{"number":"0.2.1","date":"2017-08-26T04:37:53.171Z"}],"readme":"NodeSSPI\r\n========\r\n\r\nNodeSSPI to Node.js is what [mod-auth-sspi](https://code.google.com/p/mod-auth-sspi/) to Apache HTTPD. In a nutshell NodeSSPI authenticates incoming HTTP(S) requests through native Windows SSPI, hence **NodeSSPI runs on Windows only**.\r\n\r\n## Background\r\nOrganizations using Microsoft Active Directory for enterprise-wide identity management often rely on NTLM and Kerberos - collectively known as Windows authentication, as Single-Sign-On (SSO) solution to secure various corporate web sites. Windows authentication also offers the convenience of transparent authentication by default for browsers such as Internet Explorer and Google Chrome when running on corporate Windows computers configured by group policy.\r\n\r\nArguably the most popular web server that supports Windows authentication is IIS. Apache HTTPD with module mod-auth-sspi is also a common choice, especially when used as reverse proxy (r-proxy). For Node.js to be useful in such enterprise environment, it is necessary to put Node.js behind one of these web servers to rely on them handling authentication. But this infrastructural layout defeated the design benefits of Node.js - a high performance non-blocking I/O web server more suitable acting as r-proxy than other servers mentioned in front of it.\r\n\r\nThis paradox has been impeding adoption of Node.js to the enterprise world, until the advent of NodeSSPI.\r\n\r\n## Description\r\n\r\nNodeSSPI, written mostly in C++, is modeled after mod-auth-sspi to perform Windows authentication through native Windows SSPI. NodeSSPI also supports Basic authentication against underlying Active Directory (for domain servers only) and local users (for domain and non-domain servers). After successful authentication, NodeSSPI can optionally retrieve a list of groups the user belongs to, facilitating downstream middleware to perform authorization.\r\n\r\nDespite of the resemblance, NodeSSPI is not an exact feature-wize like-for-like porting of mod-auth-sspi. This is partially because, unlike Apache, which is customizable mostly through configuration, Node.js is customizable through JavaScript which offers much more flexibility.\r\n\r\n## Usages\r\n### Overview\r\nFollowing code illustrates how to add NodeSSPI to the request processing pipeline. Although the code requires Express.js, NodeSSPI doesn't have to be run under the context of Express.js. In fact, at runtime it has no npm module dependencies.\r\n\r\n```\r\n'use strict'\r\n\r\nvar express = require('express')\r\nvar app = express()\r\nvar server = require('http').createServer(app)\r\napp.use(function (req, res, next) {\r\n  var nodeSSPI = require('node-sspi')\r\n  var nodeSSPIObj = new nodeSSPI({\r\n    retrieveGroups: true\r\n  })\r\n  nodeSSPIObj.authenticate(req, res, function(err){\r\n    res.finished || next()\r\n  })\r\n})\r\napp.use(function(req, res, next) {\r\n  var out =\r\n    'Hello ' +\r\n    req.connection.user +\r\n    '! Your sid is ' +\r\n    req.connection.userSid +\r\n    ' and you belong to following groups:<br/><ul>'\r\n  if (req.connection.userGroups) {\r\n    for (var i in req.connection.userGroups) {\r\n      out += '<li>' + req.connection.userGroups[i] + '</li><br/>\\n'\r\n    }\r\n  }\r\n  out += '</ul>'\r\n  res.send(out)\r\n})\r\n// Start server\r\nvar port = process.env.PORT || 3000\r\nserver.listen(port, function () {\r\n  console.log('Express server listening on port %d in %s mode', port, app.get('env'))\r\n})\r\n```\r\nIf you put above code in a file, say *index.js*, and run following commands from the same directory:\r\n```\r\nnpm install node-sspi\r\nnpm install express\r\nnode index.js\r\n```\r\nthen open [http://localhost:3000](http://localhost:3000) and login with your Windows account if prompted, you will see something like\r\n```\r\nHello <mypc>\\<me>! Your sid is S-*-*-**-**********-**********-**********-**** and you belong to following groups:\r\n*<mypc>\\None\r\n*\\Everyone\r\n*<mypc>\\HelpLibraryUpdaters\r\n*BUILTIN\\Administrators\r\n*BUILTIN\\Users\r\n*NT AUTHORITY\\NETWORK\r\n*NT AUTHORITY\\Authenticated Users\r\n*NT AUTHORITY\\This Organization\r\n*NT AUTHORITY\\NTLM Authentication\r\n*Mandatory Label\\High Mandatory Level\r\n\r\n```\r\n\r\n### Inputs\r\n\r\nThe call to `new nodeSSPI(opts)` in above code can take following options:\r\n  * offerSSPI: true|false \r\n      - default to *true*. Whether to offer SSPI Windows authentication\r\n  * offerBasic: true|false \r\n      - default to *true*. Whether to offer Basic authentication\r\n  * authoritative: true|false \r\n      -  default to *true*. Whether authentication performed by NodeSSPI is authoritative. If set to *true*, then requests passed to downstream are guaranteed to be authenticated because non-authenticated requests will be blocked. If set to *false*, there is no such guarantee and downstream middleware have the chance to override outputs from NodeSSPI and impose their own rules.\r\n  * perRequestAuth: false|true \r\n      - default to *false*. Whether authentication should be performed at per request level or per connection level. Per connection level is preferred to reduce overhead.\r\n  * retrieveGroups: false|true \r\n      - default to *false* for performance sake. Whether to retrieve groups upon successful authentication. See [caveats](#caveats) below.\r\n  * maxLoginAttemptsPerConnection: &lt;number&gt;\r\n      - default to *3*. How many login attempts are permitted for this connection.\r\n  * sspiPackagesUsed: &lt;array&gt;\r\n      - default to *['NTLM']*. An array of SSPI packages used. To obtain a list of all SSPI packages available on your server, download source code of [mod-auth-sspi](https://code.google.com/p/mod-auth-sspi/source/checkout), then run *bin\\sspikgs.exe* from your server's DOS console. \r\n  * domain: &lt;string&gt;\r\n      - no default value. This is the domain name (a.k.a realm) used by basic authentication if user doesn't prefix their login name with *&lt;domain_name&gt;\\\\*. \r\n\r\n### Outputs\r\n  * upon successful authentication\r\n    * authenticated user name is populated into field `req.connection.user`\r\n    * authenticated user sid is populated into field `req.connection.userSid` \r\n    * if option `retrieveGroups` is *true*, group names are populated into field `req.connection.userGroups` as an array.\r\n  * otherwise\r\n    * if option `authoritative` is set to *true*, then the request will be blocked. The reason of blocking (i.e. error message) is written to response body as well as the *err* parameter of the callback function. Some response headers such as *WWW-Authenticate* may get filled out, and one of following HTTP response codes will be populated to field `res.statusCode`:\r\n      * 403 if max login attempts are reached\r\n      * 401 for all in-progress authentications, including protocols that require multiple round trips or if max login attempts has not been reached.\r\n      * 500 when NodeSSPI encountered exception it cannot handle.\r\n    * if option `authoritative` is not set to *true*, then the output is the same as authoritative except NodeSSPI will not write error message to response body, nor block the request, i.e. it will not call `res.end(err)`. This allows the caller and downstream middleware to make decision.\r\n\r\n## Platforms\r\nNodeSSPI has been tested working on these Windows platforms:\r\n\r\n  * Windows Vista x32\r\n  * Windows 7 x64\r\n  * Windows Server 2008 R2\r\n\r\nPlatforms older than Windows 2000 are unlikely to work. Other platforms may work but haven't been tested.\r\n\r\n## Caveats\r\n  * Microsoft provides a number of SSPI [packages](http://msdn.microsoft.com/en-us/library/windows/desktop/aa380502\\(v=vs.85\\).aspx). So far only NTLM and Negotiate have been tested working. Kerberos is not working. Contribution is encouraged.\r\n  * Because basic authentication has not standarized on character encoding and browser implementation varies, if your AD supports non-ASCII user name and password, it is advised to turn off basic authentication unless you can assume all client browsers use utf-8 encoding as Chrome does. See this [stackoverflow question](http://stackoverflow.com/questions/702629/utf-8-characters-mangled-in-http-basic-auth-username) for details.\r\n  * It has been [reported](https://github.com/abbr/NodeSSPI/issues/23) that enabling *retrieveGroups* could take a heavy toll on AD domain controller in some circumstances. As an alternative, using a LDAP module that supports group filtering may improve performance.\r\n\r\n## Installation\r\nPrerequisites: Except on a few [ platforms + Node version combinations](https://github.com/abbr/NodeSSPI-bin) where binary distribution is included, NodeSSPI uses node-gyp to compile C++ source code so you may need the compilers listed in [node-gyp](https://github.com/TooTallNate/node-gyp). You may also need to [update npm's bundled node gyp](https://github.com/TooTallNate/node-gyp/wiki/Updating-npm's-bundled-node-gyp).\r\n\r\nTo install, run \r\n```npm install node-sspi```\r\n\r\n## Development\r\nPrerequisites: Visual Studio 2017\r\n\r\nRun:\r\n\r\n```\r\ngit clone git@github.com:abbr/NodeSSPITest.git NodeSSPI\r\ncd NodeSSPI\r\nnpm install\r\ncd node_modules\r\ngit clone git@github.com:abbr/NodeSSPI.git node-sspi\r\ncd node-sspi\r\nnpm install --debug\r\nnode ..\\..\\server.js\r\n```\r\n\r\nTo debug, open NodeSSPI.sln in VS2017 and attach to node.js process. \r\n\r\n\r\n## Support\r\nPull requests and issue reporting are welcome. For issues to be considered by maintainer:\r\n  1. they must be reproducible.\r\n  2. there must be evidence the issue is related to NodeSSPI.\r\n\r\nTo that end, the issue should contain platform information, error message relevant to NodeSSPI, and preferably code snippet. If code snippet is supplied, it must be self-contained, i.e. independent from your runtime environment or other modules not explictly specified via `require` in the code snippet.\r\n\r\n## License\r\n\r\nThe MIT License (MIT)\r\n\r\nCopyright (c) 2016\r\n\r\nPermission is hereby granted, free of charge, to any person obtaining a copy\r\nof this software and associated documentation files (the \"Software\"), to deal\r\nin the Software without restriction, including without limitation the rights\r\nto use, copy, modify, merge, publish, distribute, sublicense, and/or sell\r\ncopies of the Software, and to permit persons to whom the Software is\r\nfurnished to do so, subject to the following conditions:\r\n\r\nThe above copyright notice and this permission notice shall be included in all\r\ncopies or substantial portions of the Software.\r\n\r\nTHE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\r\nIMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\r\nFITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\r\nAUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\r\nLIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\r\nOUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\r\nSOFTWARE.\r\n","starsCount":5,"created":"2014-07-07T03:59:26.295Z","modified":"2017-08-26T04:37:53.171Z","lastPublisher":{"name":"abbr","email":"wenfred@gmail.com"},"owners":[{"name":"abbr","email":"wenfred@gmail.com"}],"other":{"_attachments":{},"_id":"node-sspi","_nodeVersion":"8.0.0","_npmOperationalInternal":{"host":"s3://npm-registry-packages","tmp":"tmp/node-sspi-0.2.1.tgz_1503722272895_0.698160286527127"},"_npmUser":{"name":"abbr","email":"wenfred@gmail.com"},"_npmVersion":"5.0.3","_rev":"7-b2044dc24916cce39047ae381df31086","author":{"name":"Fred Wen","email":"wenfred@gmail.com"},"bugs":{"url":"https://github.com/abbr/nodesspi/issues"},"directories":{},"dist-tags":{"latest":"0.2.1"},"dist":{"integrity":"sha512-GIczBgcS+/jCKgkxJOtzHMRKDWmcSkgCLWNNuHA9XY3eFUio2291IUhW4lTpBmYXVUTgR8LkWIlKjVX5csIbmQ==","shasum":"8b43f1504d52fc17291fd20a16632cb020437124","tarball":"https://registry.npmjs.org/node-sspi/-/node-sspi-0.2.1.tgz"},"maintainers":[{"name":"abbr","email":"wenfred@gmail.com"}],"readmeFilename":"README.md","time":{"modified":"2017-08-26T04:37:53.171Z","created":"2014-07-07T03:59:26.295Z","0.0.1":"2014-07-07T03:59:26.295Z","0.0.2":"2014-07-07T07:14:35.931Z","0.0.3":"2014-07-08T02:45:52.534Z","0.0.4":"2014-07-08T06:18:19.766Z","0.1.0":"2014-07-11T21:07:30.494Z","0.1.1":"2014-07-19T00:39:48.273Z","0.1.2":"2014-07-19T00:54:33.251Z","0.1.3":"2014-07-19T04:58:06.153Z","0.1.4":"2014-07-19T05:54:36.914Z","0.1.5":"2015-02-26T04:40:04.300Z","0.1.6":"2015-03-02T04:53:21.775Z","0.1.7":"2015-03-02T04:59:23.921Z","0.1.8":"2015-03-08T02:38:45.089Z","0.1.9":"2015-09-14T00:00:03.091Z","0.1.10":"2015-09-21T01:31:45.455Z","0.1.11":"2015-09-26T18:22:28.428Z","0.1.12":"2015-11-22T18:41:16.667Z","0.1.13":"2016-07-10T00:31:47.816Z","0.1.14":"2016-10-29T22:03:43.391Z","0.1.15":"2017-06-17T17:42:12.836Z","0.2.0":"2017-08-26T04:30:34.216Z","0.2.1":"2017-08-26T04:37:53.171Z"},"users":{"dangerdroid":true,"fistynuts":true,"shanoor":true,"hugueds":true,"vangoins":true}}}