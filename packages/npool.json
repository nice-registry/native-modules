{"preferGlobal":false,"name":"npool","version":"1.4.7","main":"./build/Release/npool.node","description":"A cross-platform thread pool add-on for Node.js and io.js","keywords":["c","c++","addon","module","pthread","native","async","thread","threadpool","thread pool","unit of work","task"],"homepage":"https://github.com/inh3/nPool","repository":"https://github.com/inh3/nPool","analyze":false,"license":"BSD-3-Clause","os":["darwin","linux","win32"],"engines":{"node":">= 0.8.28"},"engine-strict":true,"devDependencies":{"mocha":">= 1.14.0"},"scripts":{"test":"make test","install":"node-gyp rebuild"},"dependencies":{"nan":">= 2.1.0"},"gypfile":true,"gitHead":"d75c8037adddc28f1827feb2563508787db70906","versions":[{"number":"1.0.0","date":"2013-08-11T20:13:51.299Z"},{"number":"1.0.1","date":"2013-08-11T20:15:30.778Z"},{"number":"1.0.2","date":"2013-08-11T21:05:54.535Z"},{"number":"1.0.3","date":"2013-08-11T21:09:45.567Z"},{"number":"1.0.4","date":"2013-08-12T03:22:12.143Z"},{"number":"1.0.5","date":"2013-08-17T04:34:15.370Z"},{"number":"1.0.6","date":"2013-08-17T04:41:49.281Z"},{"number":"1.0.7","date":"2013-08-20T02:32:56.206Z"},{"number":"1.0.8","date":"2013-08-20T02:45:47.528Z"},{"number":"1.0.9","date":"2013-08-31T16:02:04.527Z"},{"number":"1.1.0","date":"2013-11-25T03:44:53.796Z"},{"number":"1.1.1","date":"2014-03-03T05:05:12.515Z"},{"number":"1.1.2","date":"2014-03-03T05:11:42.441Z"},{"number":"1.2.0","date":"2015-04-28T03:47:06.421Z"},{"number":"1.2.1","date":"2015-04-28T05:15:38.263Z"},{"number":"1.2.2","date":"2015-04-28T05:20:49.182Z"},{"number":"1.2.3","date":"2015-04-29T02:57:31.087Z"},{"number":"1.3.4","date":"2015-08-08T21:58:55.499Z"},{"number":"1.3.8","date":"2015-08-09T17:31:15.731Z"},{"number":"1.4.0","date":"2015-08-11T12:47:14.634Z"},{"number":"1.4.1","date":"2015-08-11T12:52:49.133Z"},{"number":"1.4.2","date":"2015-08-11T13:11:28.964Z"},{"number":"1.4.3","date":"2015-08-13T03:13:30.339Z"},{"number":"1.4.4","date":"2015-08-29T16:38:48.347Z"},{"number":"1.4.5","date":"2015-09-12T05:15:15.003Z"},{"number":"1.4.6","date":"2015-10-09T08:07:23.643Z"},{"number":"1.4.7","date":"2015-11-07T18:36:28.303Z"}],"readme":"# nPool [![NPM version](https://badge.fury.io/js/npool.png)](http://badge.fury.io/js/npool) [![Build Status](https://travis-ci.org/inh3/nPool.png)](https://travis-ci.org/inh3/nPool) [![Build status](https://ci.appveyor.com/api/projects/status/h11e52tnnk1a7gr3)](https://ci.appveyor.com/project/inh3/npool)\n\nA platform independent thread pool add-on for [Node.js](http://nodejs.org/api/addons.html) and [io.js](https://iojs.org/api/addons.html).\n\n**nPool's primary features and benefits include:**\n\n * Linux, Mac and Windows support\n   * CI with automated testing on all platforms\n * Efficient and straightforward interface\n * Emulated [Node.js module](http://nodejs.org/api/modules.html#modules_modules) loading system within threads\n * Transparent marshalling of Javascript objects in and out of the thread pool\n * User defined context of the callback function executed after task completion\n * Use of object types to complete units of work\n * Support for UTF-8 strings\n * Exception and error handling within background threads\n * Node.js [global object](http://nodejs.org/api/globals.html) support within background threads\n   * `console.log`, `__filename`, `__dirname`, `require`\n * Verified and validated with a comprehensive [mocha](http://visionmedia.github.io/mocha/) test suite\n\n**Support for all stable [Node.js](https://nodejs.org) and [io.js](https://iojs.org) releases:**\n\n###### Node.js\n\n * 0.8.x, 0.10.x, 0.12.x, 4.x.x, 5.x.x\n\n###### io.js\n\n * 1.x.x, 2.x.x, 3.x.x\n\n## Table of Contents\n\n* [The Implementation](#the-implementation)\n* [Installation](#installation)\n* [Building From Source](#building-from-source)\n* [Example](#example)\n* [API Documentation](#api-documentation)\n* [Thread Module Support](#thread-module-support)\n* [Future Development](#future-development)\n* [License](#license)\n\n## The Implementation\n\nnPool is written entirely in C/C++.  The thread pool and synchronization frameworks are written in C and the add-on interface is written in C++.  The library has no third-party dependencies other than [Node.js](http://nodejs.org/), [V8](https://code.google.com/p/v8/), and [nan](https://github.com/iojs/nan).\n\nThe cross-platform threading component utilizes [`pthreads`](https://computing.llnl.gov/tutorials/pthreads/) for Mac and Linux.  On Windows, native threads ([`_beginthreadex`](http://msdn.microsoft.com/en-us/library/kdzttdcb.aspx)) and [`CRITICAL_SECTIONS`](http://msdn.microsoft.com/en-us/library/windows/desktop/ms682530) are used.  Task based units of work are performed via a FIFO queue that is processed by the thread pool.  Each thread within the thread pool utilizes a distinct [`v8::Isolate`](http://izs.me/v8-docs/classv8_1_1Isolate.html) to execute javascript parallely.  Callbacks to the main Node.js thread are coordinated via [libuvâ€™s](http://nikhilm.github.io/uvbook/introduction.html) [`uv_async`](http://nikhilm.github.io/uvbook/threads.html#inter-thread-communication) inter-thread communication mechanism.\n\nOne thing to note, [`unordered_maps`](http://en.cppreference.com/w/cpp/container/unordered_map) are used within the add-on interface, therefore, it is necessary that the platform of choice provides [C++11](http://en.wikipedia.org/wiki/C%2B%2B11) (Windows and Linux) or [TR1](http://en.wikipedia.org/wiki/C%2B%2B_Technical_Report_1) (Apple) implementations of the standard library.\n\n## Installation\n\n[![NPM](https://nodei.co/npm/npool.png?downloads=true)](https://nodei.co/npm/npool/)\n\n## Building From Source\n\nnPool can be easily compiled on Mac, Linux and Windows using [`node-gyp`](https://github.com/TooTallNate/node-gyp).\n\nSimply run the following command within a console or terminal `node-gyp clean configure build`.\n\nThis will automatically configure the environment and produce the add-on module.\n\n**Requirements:**\n\n* Node.js or io.js\n* Standard C and C++ libraries\n * Windows: C++11\n * Linux: C++0x/C++11\n * Mac: TR1\n* Core GNU build toolchain\n\n*Currently during development the following compilers are tested:*\n * gcc/g++ 4.9.1 (Ubuntu)\n * clang 5.0 (Mac OS X Mavericks)\n * Visual Studio Express 2013 (Windows 8.1)\n\n## Example\n\nA reference implementation is provided with the source in the [`./example`](https://github.com/inh3/nPool/tree/master/example) folder.\n\n## API Documentation\n\nnPool provides a very simple and efficient interface.  Currently, there are a total of five functions:\n\n1. [`createThreadPool`](#createthreadpool)\n2. [`destroyThreadPool`](#destroythreadpool)\n3. [`loadFile`](#loadfile)\n4. [`removeFile`](#removefile)\n5. [`queueWork`](#queuework)\n\n**Example:**\n```js\n// load nPool module\nvar nPool = require('npool');\n\n// work complete callback from thread pool\nvar callbackFunction = function (callbackObject, workId, exceptionObject) { ... }\n\n// load files defining object types\nnPool.loadFile(1, __dirname + '/objectType.js');\n\n// create thread pool with two threads\nnPool.createThreadPool(2);\n\n// create the unit of work object\nvar unitOfWork = {\n    workId: 9124,\n    fileKey: 1,\n    workFunction: \"objectMethod\",\n    workParam: {\n        aProperty: [ 134532, \"xysaf\" ]\n    },\n\n    callbackFunction: callbackFunction,\n    callbackContext: this\n}\n\n// queue the unit of work\nnPool.queueWork(unitOfWork);\n```\n\n---\n\n### createThreadPool\n\n```js\ncreateThreadPool(numThreads)\n```\n\nThis function creates the thread pool.  At this time, the module only supports one thread pool per Node.js process.  Therefore, this function should only be called once, prior to `queueWork` or `destroyThreadPool`.\n\nThe function takes one parameter:\n\n * `numThreads` *uint32* - number of threads to create within the thread pool\n\n**Example:**\n\n```js\n// create thread pool with two threads\nnPool.createThreadPool(2);\n```\n\n---\n\n### destroyThreadPool\n\n```js\ndestroyThreadPool()\n```\n\nThis function destroys the thread pool.  This function should only be called once and only when there will be no subsequent calls to the `queueWork` function.  This method can be called safely even if there are tasks still in progress.  At a lower level, this actually signals all threads to exit, but causes the main thread to block until all threads finish their currently executing in-progress units of work.  This does block the main Node.js thread, so this should only be executed when the process is terminating.\n\nThis function takes no parameters.\n\n**Example:**\n\n```js\n// destroy the thread pool\nnPool.destroyThreadPool();\n```\n\n---\n\n### loadFile\n\n```js\nloadFile(fileKey, filePath)\n```\n\nThis function serializes a javascript file that contains a constructor function for an object type.  The file buffer will be cached on the Node.js main thread.\n\nThis function can be called at any time.  It should be noted that this is a synchronous call, so the serialization of the file will occur on the main thread of the Node.js process.  That being said, it would be prudent to load all necessary files at process startup, especially since they will be cached in memory.\n\nEach thread, on first execution with a unit of work which requires the file referenced by `fileKey`, will de-serialize and compile the contents into a V8 function. The function is used to instantiate a new persistent V8 object instance of the object type.  The persistent object instance is then cached per thread.  Every subsequent unit of work referencing the `fileKey` will retrieve the already cached object instance.\n\nThis function takes two parameters:\n\n * `fileKey` *uint32* - uniquely identifies a file\n * `filePath` *string* - path to javascript file to be cached\n\nEach file must have a unique key.\n\nAlso, it is important that the full path to the javascript file is provided.  The best practice is to use `__dirname` in addition to the relative path to the file.\n\n**Example:**\n\n```js\n// load files defining object types\nnPool.loadFile(1, __dirname + '/objectType.js');\n```\n\nFiles that are loaded should define an object type (function) that can be instantiated.  Keep in mind this object is used as a service and should be stateless.\n\nAn example file is given below:\n\n```js\n// ./applesOranges.js\n\n// utilize a node.js like require\nvar _ = require('./underscore.js');\n\nvar ApplesOranges = function() {\n\n    // function that matches the unit of work defined work function\n    this.getFruitNames = function (workParam) {\n\n        // total number of fruits\n        var fruitCount = 0;\n\n        // count number of fruits\n        _.each(workParam.fruitArray, function(element) {\n            fruitCount++;\n        });\n\n        // return callback object\n        return {\n            // return passed in parameter\n            origFruitArray: workParam.fruitArray,\n\n            // using underscore.js\n            fruitNames: _.pluck(workParam.fruitArray, \"name\"),\n            fruitCount: fruitCount\n        };\n    };\n}\n\n// replicate Node.js module loading behavior\nmodule.exports = ApplesOranges;\n```\n\n---\n\n### removeFile\n\n```js\nremoveFile(fileKey)\n```\n\nThis function removes a javascript file from the file cache.  This function can be called at any time, with one caveat.  The user should take care to not remove files that are currently referenced in pending units of work that have yet to be processed by the thread pool.\n\nThis function takes one parameter:\n\n * `fileKey` *uint32* - unique key for a loaded file\n\nThere must exist a file for the given key.\n\n**Example:**\n\n```js\n// remove file associated with fileKey: 1\nnPool.removeFile(1);\n```\n\n---\n\n### queueWork\n\n```js\nqueueWork(unitOfWorkObject)\n```\n\nThis function queues a unit of work for execution on the thread pool.  This function should be called after `createThreadPool` and prior to `destroyThreadPool`.\n\nThe function takes one parameter, a unit of work object which contains specific and required properties.\n\nA `unitOfWorkObject` contains the following named properties:\n\n * `workId` *uint32* - This parameter is a unique integer that identifies a unit of work.  This integer is later passed as a parameter to the work complete callback function.\n\n * `fileKey` *uint32* - This parameter is an integer that is used as a key to reference a file that was previously cached via the `loadFile` function.  At this time there is no run-time logic to handle the a case when a file key does not reference a previously loaded file.  Therefore, ensure that a file exists for the given key.\n\n * `workFunction` *string* - This parameter is a string that declares the name of a function.  This function name will be used in conjunction with the `fileKey` in order to reference a specific object instance method.   The function name must match a method on the object type that is defined by the file associated with the given `fileKey`.  The method will be called from within a background thread to process the unit of work object passed to `queueWork`.  This function should ultimately return an object which is passed to the `callbackFunction`.\n\n * `workParam` *object* - This is user defined object that is the input for the task.  The object will be passed as the only parameter to the object instance method that is executed in the thread pool.  Any function properties on the object will not be available when it is used in the thread pool because serialization does not support packing functions.\n\n * `callbackFunction` *function* - This property specifies the work complete callback function.  The function is executed on the main Node.js thread.\nThe work complete callback function takes the following parameters:\n  * `callbackObject` *object* - the object that is returned by the `workFunction`\n  * `workId` *uint32* -  the unique identifier, `workId`, that was passed with the unit of work when it was queued\n  * `exceptionObject` *object* -  the object that contains exception information\n    - This is `null` if no exceptions occured during work\n    - This object contains the following properties:\n        - `message` *string* - the exception message (always present)\n        - `resourceName` *string* - name of the file where the exception occured (not always present depending on error)\n        - `lineNum` *uint32* - line number within the resource where the exception occured (not always present depending on error)\n        - `sourceLine` *string* - line of code within resource where the exception occured (not always present depending on error)\n        - `stackTrace` *string* - string format of stack trace (includes '\\n's) of the exception (not always present depending on error)\n\n * `callbackContext` *context* - This property specifies the context (`this`) of the `callbackFunction` when it is called.\n\n**Example:**\n\n```js\n// create the unit of work object\nfunction myCallbackFunction(callbackObject, workId, exceptionObject) {\n    if(exceptionObject == null) {\n        // work was performed successfully\n        ...\n    }\n    else {\n        // exception or error occured during work\n        console.log(exceptionObject);\n    }\n}\n\nvar unitOfWork = {\n\n\t\t// unique identifer of unit of work\n\t\tworkId: 34290,\n\n\t\t// object type file\n\t\tfileKey: 1,\n\n\t\t// object instance function to perform unit of work\n\t\tworkFunction: \"objectMethodName\",\n\n\t\t// object to be passed to work function\n\t\tworkParam: {\n\t\t\tarrayProperty: [ ... ],\n\t\t\tobjectProperty: { ... },\n\t\t\tvalueProperty: 123,\n\t\t\tstringProperty: \"abcd\"\n\t\t},\n\n\t\t// function that will be called on main Node.js when the task is complete\n\t\tcallbackFunction: myCallbackFunction,\n\n\t\t// context that the callbackFunction will be called in\n\t\tcallbackContext: someOtherObject\n};\n```\n```js\n// queue the unit of work\nnPool.queueWork(unitOfWork);\n```\n\n## Thread Module Support\n\nnPool emulates the [Node.js module system](http://nodejs.org/api/modules.html#modules_modules) for loaded files.  The module loading system is emulated because the native functionality is embedded within the Node.js process and is only available within the main Node.js thread.\n\nThe emulated module loading system has the following features/limitations:\n\n* Similar `require(...)` syntax as Node.js\n * Currently only individual file-based require() is supported\n * Paths that start with `./` and `../` automatically resolve relative to the file performing the `require()`\n* Limited to pure Javascript modules\n * No native or compiled add-ons\n* Supports nested modules\n * Required module requiring other modules\n\n```js\n// if the current path is '/home/path/'\n// this will require module '/home/path/aModule.js'\nvar TheModule = require('./aModule.js');\n```\n```js\n// if the current path is '/home/path/'\n// this will require module '/home/aModule.js'\nvar TheModule = require('../aModule.js');\n```\n```js\n// if the current path is '/home/path/'\n// this will require module '/home/path/aModule.js'\nvar TheModule = require(__dirname + '/aModule.js');\n```\n\nThe reference implementation provided with the source ([`./example`](https://github.com/inh3/nPool/tree/master/example)) demonstrates the emulated module loading mechanism.\n\n## Future Development\n\n1. Full [Node.js require() algorithm](http://nodejs.org/api/modules.html#modules_all_together) support (excluding native add-ons).\n2. Event based notification and completion mechanism (ie. could be used to indicate progress of task).\n3. Multiple thread pools per Node.js process\n\n## License\n\n```\nCopyright (c) 2015, Ivan Hall <ivan.hall@gmail.com>\nAll rights reserved.\n\nRedistribution and use in source and binary forms, with or without\nmodification, are permitted provided that the following conditions are met:\n\n    * Redistributions of source code must retain the above copyright\n      notice, this list of conditions and the following disclaimer.\n    * Redistributions in binary form must reproduce the above copyright\n      notice, this list of conditions and the following disclaimer in the\n      documentation and/or other materials provided with the distribution.\n    * Neither the name of nPool nor the names of its contributors may be used\n      to endorse or promote products derived from this software without specific\n      prior written permission.\n\nTHIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS \"AS IS\" AND\nANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED\nWARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE\nDISCLAIMED. IN NO EVENT SHALL THE AUTHORS BE LIABLE FOR ANY\nDIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES\n(INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;\nLOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND\nON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT\n(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS\nSOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.\n```\n","starsCount":6,"created":"2013-08-11T20:13:50.246Z","modified":"2016-09-29T11:04:00.735Z","lastPublisher":{"name":"inh3","email":"ivan.hall@gmail.com"},"owners":[{"name":"inh3","email":"ivan.hall@gmail.com"}],"other":{"_attachments":{},"_from":".","_id":"npool","_nodeVersion":"5.0.0","_npmUser":{"name":"inh3","email":"ivan.hall@gmail.com"},"_npmVersion":"3.3.6","_rev":"1-3ad00f747101937bbc865970e865d1aa","_shasum":"c80e35294df35551071a1527930f48f76e414e97","author":{"name":"Ivan Hall","email":"ivan.hall@gmail.com"},"bugs":{"url":"https://github.com/inh3/nPool/issues","email":"ivan.hall@gmail.com"},"directories":{},"dist-tags":{"latest":"1.4.7"},"dist":{"shasum":"c80e35294df35551071a1527930f48f76e414e97","tarball":"http://registry.npmjs.org/npool/-/npool-1.4.7.tgz"},"maintainers":[{"name":"inh3","email":"ivan.hall@gmail.com"}],"readmeFilename":"README.md","time":{"modified":"2016-09-29T11:04:00.735Z","created":"2013-08-11T20:13:50.246Z","1.0.0":"2013-08-11T20:13:51.299Z","1.0.1":"2013-08-11T20:15:30.778Z","1.0.2":"2013-08-11T21:05:54.535Z","1.0.3":"2013-08-11T21:09:45.567Z","1.0.4":"2013-08-12T03:22:12.143Z","1.0.5":"2013-08-17T04:34:15.370Z","1.0.6":"2013-08-17T04:41:49.281Z","1.0.7":"2013-08-20T02:32:56.206Z","1.0.8":"2013-08-20T02:45:47.528Z","1.0.9":"2013-08-31T16:02:04.527Z","1.1.0":"2013-11-25T03:44:53.796Z","1.1.1":"2014-03-03T05:05:12.515Z","1.1.2":"2014-03-03T05:11:42.441Z","1.2.0":"2015-04-28T03:47:06.421Z","1.2.1":"2015-04-28T05:15:38.263Z","1.2.2":"2015-04-28T05:20:49.182Z","1.2.3":"2015-04-29T02:57:31.087Z","1.3.4":"2015-08-08T21:58:55.499Z","1.3.8":"2015-08-09T17:31:15.731Z","1.4.0":"2015-08-11T12:47:14.634Z","1.4.1":"2015-08-11T12:52:49.133Z","1.4.2":"2015-08-11T13:11:28.964Z","1.4.3":"2015-08-13T03:13:30.339Z","1.4.4":"2015-08-29T16:38:48.347Z","1.4.5":"2015-09-12T05:15:15.003Z","1.4.6":"2015-10-09T08:07:23.643Z","1.4.7":"2015-11-07T18:36:28.303Z"},"users":{"trubit":true,"li901029":true,"litmaj0r":true,"guananddu":true,"horpto":true,"andr":true}}}