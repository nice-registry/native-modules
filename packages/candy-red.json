{"name":"candy-red","version":"5.0.1","description":"CANDY RED Device Gateway Service powered by Node-RED","main":"./dist/index.js","scripts":{"start":"NODE_PALETTE_ENABLED=true node ./dist/index.js","build":"gulp build","clean":"gulp clean","test":"gulp test","preinstall":"./install.sh test","postinstall":"./install.sh","preuninstall":"./uninstall.sh","prepublish":"if [ -d ./src ] ; then gulp test && gulp clean && gulp build; fi","freeze":"npm prune && npm shrinkwrap --only=prod"},"repository":"https://github.com/CANDY-LINE/candy-red","keywords":["rpi","raspberry-pi","raspbian","enocean","CANDY EGG"],"license":"Apache-2.0","homepage":"https://github.com/CANDY-LINE/candy-red#readme","preferGlobal":true,"os":["!win32"],"devDependencies":{"babel":"^6.23.0","babel-cli":"^6.24.0","babel-plugin-add-module-exports":"^0.2.1","babel-preset-babili":"0.1.4","babel-preset-es2015":"^6.24.0","chai":"^4.1.0","gulp":"^3.9.1","gulp-babel":"^6.1.2","gulp-clean":"^0.3.2","gulp-cli":"^1.2.2","gulp-exec":"^2.1.3","gulp-jshint":"^2.0.4","gulp-livereload":"^3.8.1","gulp-mocha":"^4.3.0","gulp-rename":"^1.2.2","gulp-sourcemaps":"^2.5.1","gulp-symlink":"^2.1.4","gulp-uglify":"^3.0.0","jshint":"^2.9.1","jshint-stylish":"^2.0.1","mocha":"^3.0.2","rmdir":"^1.2.0","run-sequence":"^2.0.0","sinon":"^2.1.0"},"dependencies":{"chokidar":"^1.4.2","es6-promises":"^1.0.10","express":"^4.14.0","follow-redirects":"^1.2.0","lru-cache":"^4.0.0","mkdirp":"^0.5.1","mustache":"^2.2.1","nan":"^2.4.0","node-enocean":"^1.8.0","node-red":"^0.17.5","node-red-contrib-device-stats":">=1.0.2","node-red-contrib-moment":"^2.0.0","node-red-dashboard":"^2.4.3","node-red-node-serialport":"^0.4.2","request":"^2.74.0","serialport":"~4.0.7","source-map-support":"^0.4.2","ws":"^2.2.1"},"gitHead":"23dc9997cde633542459ab10e1b48d270470f5ab","readme":"CANDY RED\n===\n\n[![GitHub release](https://img.shields.io/github/release/CANDY-LINE/candy-red.svg)](https://github.com/CANDY-LINE/candy-red/releases/latest)\n[![master Build Status](https://travis-ci.org/CANDY-LINE/candy-red.svg?branch=master)](https://travis-ci.org/CANDY-LINE/candy-red/)\n[![License MIT](https://img.shields.io/github/license/CANDY-LINE/candy-red.svg)](http://opensource.org/licenses/MIT)\n\nCANDY RED is a gateway service working between local area wireless network devices and internet servers.\n\n## Features\n\n* Include Node-RED flow editor/flow execution runtime\n* Running as a systemd service\n* Preinstalled EnOcean node\n* Preinstalled helper nodes for CANDY EGG cloud service \\*\n\n_\\* [CANDY EGG cloud service](https://www.candy-line.io/%E8%A3%BD%E5%93%81%E4%B8%80%E8%A6%A7/candy-red-egg/) account is required_\n\n## OS and Hardwares\n\n* [Raspberry Pi + Raspbian](#raspberry-pi--raspbian)\n* [OSX/Linux for Development](#development)\n\n# Screenshots\n## CANDY RED flow editor page on browser\n\nThis is the default screen theme.\n\n![CANDY RED Screenshot](https://raw.githubusercontent.com/CANDY-LINE/candy-red/master/images/screenshot-candy-red.png \"CANDY RED Screenshot\")\n\n# Raspberry Pi + Raspbian\n\n## Prerequisites\n\n### Raspbian version\n\n * JESSIE/JESSIE LITE Kernel Version: 4.9 (2017-07-05)\n\n### Tested Node.js versions\n\n* v6.11.2\n\nThe preinstalled version of Node.js v0.10.29 won't work because of the [header file issue](http://dustinbolton.com/replace_invalid_utf8-is-not-a-member-of-v8string-installing-nodejs-packages-on-raspbian-debian-on-raspberry-pi-2-b/) appearing on installing native addons.\n\nI highly recommend you to uninstall the preinstalled version of Node.js, Node-RED (which depends on `nodejs` and `nodejs-legacy` packages) and npm by the following command, and to install another version instead.\n\n```\n$ sudo apt-get remove -y nodered nodejs nodejs-legacy npm\n```\n\n### Supported npm version\n\n* v3.x (same as default npm bundled with Node.js v6)\n\n## Install/Version-up\n\nThe module installation will take around 30 minutes on RPi1. On RPi2+, the installation time will be shorter.\n\nPlease consider to change your hostname as [described below](#change-hostname) prior to installing CANDY RED.\n\n`--unsafe-perm` flag is required for installing this project module since npm performs privileged actions during the installation. This is discussed in the [issue](https://github.com/voodootikigod/node-serialport/issues/535).\n\nYou can ignore `npm WARN`s, `gyp WARN`s, `gyp ERR!`s and `node-pre-gyp ERR!`s unless the installation terminates normally. You can check if the installation is successful by `sudo service candy-red status` command after running `install.sh` script as well as `npm install`.\n\n** Please export your flow data prior to performing version-up **\n\nPlease refer to the following commands to install.\n\n```\n$ sudo NODE_OPTS=--max-old-space-size=256 npm install -g --unsafe-perm candy-red\n```\n\nYou can access `http://<hostname.local or ip address>:8100` with your browser on the same LAN where `<hostname.local or ip address>` is a host name with `.local` suffix or IP address.\n\n## Stop/Start/Status Service\n\nThe service name is `candy-red`. As of Jessie, systemd comes as a default system manager.\n\n```\n$ sudo systemctl stop candy-red\n$ sudo systemctl start candy-red\n$ sudo systemctl status candy-red\n```\n\n## Uninstall\n\n```\n$ sudo npm uninstall -g --unsafe-perm candy-red\n```\n\nIf you run `sudo npm uninstall -g candy-red` (without `--unsafe-perm`) and see `[ERROR] This script must be run as root` message, please run the following commands in order to reset systemd configurations.\n\n```\n$ sudo systemctl stop candy-red\n$ sudo systemctl disable candy-red\n$ sudo rm -f \"$(dirname $(dirname $(which systemctl)))/lib/systemd/system/candy-red.service\"\n```\n\n## RPi Tips\n\n### Change Hostname\n\nSince RPi hostname is `raspberrypi` by default, you will get confused when you have 2 or more devices and they're online.\n\nYou can change the host name by either `sudo raspi-config` or modifying `/etc/hosts`. Regarding the latter method, here is a brief instruction.\n\n```\n$ export NEW_NAME=\"my-candy-pi\" # Modify my-candy-pi as you like\n$ sudo sed -i -e \"s/raspberrypi/${NEW_NAME//\\//\\\\/}/g\" /etc/hosts\n$ sudo sed -i -e \"s/raspberrypi/${NEW_NAME//\\//\\\\/}/g\" /etc/hostname\n$ sudo /etc/init.d/hostname.sh && sudo reboot\n```\nYou can ignore `sudo: unable to resolve host raspberrypi` error message.\n\n### BLE USB adaptor/dongle\n\nCANDY RED service tries to activate the `hci0` device if it exists on boot so that you can use BLE devices on the flow editor. This is performed silently at background and you usually don't have to care of it.\n\nHowever, you need to tell the system to restart the CANDY RED service by performing `sudo systemctl restart candy-red` when you insert the dongle after boot. Or BLE is not available.\n\n### Node-RED home\n\nThe Node-RED home path, where flow files are placed, is found at `$(npm root -g)/candy-red/.node-red/`.\n\n### Slow boot time\n\nIt takes up to around a minute to boot up the service. Please be patient and wait until the service is online.\n\n### BlueZ source code build\n\nThe latest Raspbian offers you to install BlueZ with `apt-get` command as described above.\nHowever, you can still use the latest version of BlueZ if you want.\n\nYou can find the installation instruction in the [article](http://www.elinux.org/RPi_Bluetooth_LE). The compilation takes around 40 minutes (RPi B+).\n\nHere is a brief instruction. (Check the latest version of BlueZ at www.bluez.org)\n```\n$ BLUEZ_VER=5.45\n$ sudo apt-get install -y build-essential libdbus-1-dev \\\n    libdbus-glib-1-dev libglib2.0-dev libical-dev \\\n    libreadline-dev libudev-dev libusb-dev make\n$ wget https://www.kernel.org/pub/linux/bluetooth/bluez-${BLUEZ_VER}.tar.xz\n$ tar xvf bluez-${BLUEZ_VER}.tar.xz\n$ cd bluez-${BLUEZ_VER}\n$ ./configure\n$ make\n$ sudo make install\n```\n\n# Configuration\n\n## Initial Welcome Flow\n\nWelcome flow is a sample flow for helping users to understand the flow editor, which is created by CANDY RED when user's flow is missing.\n\n`WELCOME_FLOW_URL` environmental variable allows users to specify the initial welcome flow file in URL form. You can set it on installation by, for example, `WELCOME_FLOW_URL=http://... npm install -g ....`.\n\nBy default, [`welcome-flow.json`](src/welcome-flow.json) is used as the initial flow.\n\nNote that the downloaded flow file will be discarded if it is not a valid JSON data.\n\n# Development\n\n## Prerequisites\n\n### Supported Node.js versions\n\n* v6.11\n\n## Setup for Building\n\nInstall the local dependencies.\n\n```\n$ git clone https://github.com/CANDY-LINE/candy-red.git\n$ cd candy-red\n$ DEVEL=true npm install\n```\n\n## Build\n\n```\n$ npm run build\n```\n\nThe processed files are placed under `dist` directory.\n\n## Version up\n\nJust pull the update on the `candy-red` directory and perform `npm install`.\n\n```\n$ cd candy-red\n$ git pull\n$ npm install\n```\n\n## Run on localhost for development use\n\nTry the following commands after `npm run build`:\n(Prepends `sudo` for Raspbian)\n\n```\n$ npm run start\n```\n\nWith a remote welcome flow file:\n\n```\n$ WELCOME_FLOW_URL=https://git.io/vKx5r npm run start\n```\n\nAnd you'll see the sensor info like this:\n\n    [INFO] Default welcome flow has been created\n    29 Jul 21:52:35 - [info] [CANDY RED] flowFileSignature: 6cbf44cb244f38acf29d2ef061aabc4ac70e991a\n    29 Jul 21:52:35 - [info] [CANDY RED] Deploying Flow Editor UI...\n\n\n    Welcome to Node-RED\n    ===================\n\n    29 Jul 21:52:35 - [info] Node-RED version: v0.14.6 [candy-red v2.6.3]\n    29 Jul 21:52:35 - [info] Node.js  version: v4.4.7\n    29 Jul 21:52:35 - [info] Darwin 15.6.0 x64 LE\n    29 Jul 21:52:35 - [info] Loading palette nodes\n    29 Jul 21:52:36 - [info] UI started at /api/ui\n    29 Jul 21:52:36 - [warn] ------------------------------------------------------\n    29 Jul 21:52:36 - [warn] [rpi-gpio] Info : Ignoring Raspberry Pi specific node\n    29 Jul 21:52:36 - [warn] ------------------------------------------------------\n    29 Jul 21:52:36 - [info] User directory : /Users/guest/.node-red\n    29 Jul 21:52:36 - [info] Flows file     : /Users/guest/.node-red/flows_candy-red.json\n    29 Jul 21:52:36 - [info] [BLE] Set up done\n    29 Jul 21:52:36 - [info] Listen port=8100\n    29 Jul 21:52:36 - [info] Starting flows\n    29 Jul 21:52:36 - [info] [inject:89c364b0.763c98] repeat = 1000\n    29 Jul 21:52:36 - [info] Started flows\n\n## Test\n\n```\n$ npm test\n```\n\n## Package\n\n```\n$ npm pack\n# RPi\n$ sudo npm uninstall -g --unsafe-perm candy-red\n$ time sudo npm install -g --unsafe-perm ./candy-red-5.0.0.tgz\n```\n\n## Vagrant\n\n### Version\n\n * v1.8.4+\n\n### Run on Vagrant Instance\n\n```\n(host)  $ vagrant up\n(host)  $ vagrant ssh\n(varant)$ cd /vagrant\n(varant)$ npm install\n(varant)$ npm run start\n```\n\n### Local Installation Test\n\n```\n(host)  $ vagrant up\n(host)  $ vagrant ssh\n(varant)$ cd /vagrant\n(varant)$ npm pack\n(varant)$ mv *.tgz /tmp\n(varant)$ cp ./install.sh /tmp\n(varant)$ cd /tmp\n(varant)$ sudo TARBALL=/tmp/candy-red-<version>.tgz ./install.sh\n```\n\nThen access to `http://localhost:8100/red/` with a browser on the host OS.\n\n## Docker\n\n### Image Building\n\n```\n$ cd candy-red\n$ docker build -t candy-red .\n```\n\n### Run CANDY RED container\n\nRun in foreground:\n```\n$ docker run -ti --rm candy-red\n```\n\n`Ctrl+C` to exit.\n\nRun in background:\n```\n$ docker run -tid --name candy-red candy-red\n```\n\nRun `docker rm -f candy-red` to stop (and remove) the container.\n\n### Run CANDY RED container with manually built code\n\nRun in foreground:\n```\n$ npm run build\n$ docker run -ti --rm -v ./dist:/candy-red-dist candy-red\n```\n\nRun in background:\n```\n$ npm run build\n$ docker run -tid -v ./dist:/candy-red-dist candy-red\n```\n\n### Shrinkwrap\n\n```\n$ rm -fr node_modules; \\\n  rm -f npm-shrinkwrap.json; \\\n  docker run --name build --rm -ti -v $(pwd):/work -w /work -e DEVEL=true \\\n    node:6.11 bash -c \"npm install;npm run freeze\"\n```\n\n## Coding Styles\n\n1. Use ES6 (except Gruntfile.js and \\*.html)\n1. 2-space soft tabs\n1. Append .es6.js suffix to ES6 JS files\n1. See .jshintrc for detail\n\n## Known Issues\n\n* CANDY EGG cloud services aren't yet available\n\n## TODO\n* publish local Node-RED nodes in this project to npm repository\n\n### Files including the package version\n\n1. README.md\n1. [package.json](package.json)\n\n# Copyright and License\n\nPNG/ICO images under src/public folder are released under [CC BY-NC-SA](http://creativecommons.org/licenses/by-nc-sa/4.0/), Â© 2017 CANDY LINE INC.\n\nOther stuff than the files above in this project repository is released under MIT. See [LICENSE](LICENSE) for the license terms and the copyright.\n","versions":[{"number":"2.1.0","date":"2016-02-11T08:57:47.540Z"},{"number":"2.1.1","date":"2016-02-11T09:53:25.429Z"},{"number":"2.1.2","date":"2016-02-11T10:39:46.000Z"},{"number":"2.3.0","date":"2016-03-04T04:50:30.949Z"},{"number":"2.4.0","date":"2016-04-24T07:00:26.504Z"},{"number":"2.5.0","date":"2016-07-27T01:53:53.899Z"},{"number":"2.6.1","date":"2016-07-29T01:46:27.280Z"},{"number":"2.6.2","date":"2016-07-29T09:31:36.837Z"},{"number":"2.6.3","date":"2016-07-29T12:55:31.466Z"},{"number":"2.7.0","date":"2016-07-31T10:26:31.879Z"},{"number":"2.8.0","date":"2016-09-06T02:28:58.346Z"},{"number":"2.8.1","date":"2016-10-15T09:12:25.092Z"},{"number":"2.8.2","date":"2016-11-15T08:13:12.339Z"},{"number":"2.9.0","date":"2016-11-18T08:20:41.408Z"},{"number":"2.9.1","date":"2016-11-19T07:03:42.691Z"},{"number":"3.0.0","date":"2017-03-16T06:43:14.921Z"},{"number":"3.1.0","date":"2017-04-07T09:30:28.599Z"},{"number":"4.0.0","date":"2017-06-18T07:09:51.443Z"},{"number":"5.0.0","date":"2017-08-07T01:16:31.510Z"},{"number":"5.0.1","date":"2017-08-17T10:45:34.190Z"}],"created":"2016-02-11T08:57:47.540Z","modified":"2017-08-17T10:45:34.190Z","lastPublisher":{"name":"dbaba","email":"baba.daisuke@gmail.com"},"owners":[{"name":"dbaba","email":"baba.daisuke@gmail.com"}],"other":{"_attachments":{},"_from":".","_id":"candy-red","_nodeVersion":"4.7.0","_npmOperationalInternal":{"host":"s3://npm-registry-packages","tmp":"tmp/candy-red-5.0.1.tgz_1502966733961_0.3283076104708016"},"_npmUser":{"name":"dbaba","email":"baba.daisuke@gmail.com"},"_npmVersion":"4.6.1","_rev":"9-b8e1d48a0aadb9007bbfde6985b289fd","_shasum":"a8173d791f91efddc05211b5709ed21192a7a2fb","author":{"name":"Daisuke Baba"},"bugs":{"url":"https://github.com/CANDY-LINE/candy-red/issues"},"directories":{},"dist-tags":{"latest":"5.0.1"},"dist":{"shasum":"a8173d791f91efddc05211b5709ed21192a7a2fb","tarball":"https://registry.npmjs.org/candy-red/-/candy-red-5.0.1.tgz"},"maintainers":[{"name":"dbaba","email":"baba.daisuke@gmail.com"}],"readmeFilename":"README.md","time":{"modified":"2017-08-17T10:45:34.190Z","created":"2016-02-11T08:57:47.540Z","2.1.0":"2016-02-11T08:57:47.540Z","2.1.1":"2016-02-11T09:53:25.429Z","2.1.2":"2016-02-11T10:39:46.000Z","2.3.0":"2016-03-04T04:50:30.949Z","2.4.0":"2016-04-24T07:00:26.504Z","2.5.0":"2016-07-27T01:53:53.899Z","2.6.1":"2016-07-29T01:46:27.280Z","2.6.2":"2016-07-29T09:31:36.837Z","2.6.3":"2016-07-29T12:55:31.466Z","2.7.0":"2016-07-31T10:26:31.879Z","2.8.0":"2016-09-06T02:28:58.346Z","2.8.1":"2016-10-15T09:12:25.092Z","2.8.2":"2016-11-15T08:13:12.339Z","2.9.0":"2016-11-18T08:20:41.408Z","2.9.1":"2016-11-19T07:03:42.691Z","3.0.0":"2017-03-16T06:43:14.921Z","3.1.0":"2017-04-07T09:30:28.599Z","4.0.0":"2017-06-18T07:09:51.443Z","5.0.0":"2017-08-07T01:16:31.510Z","5.0.1":"2017-08-17T10:45:34.190Z"}}}